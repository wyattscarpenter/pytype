name: CI (Windows)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:

  build_windows:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4
      with:
        submodules: true

    - name: Download Python
      run: Invoke-WebRequest -Uri 'https://www.python.org/ftp/python/3.10.5/python-3.10.5-amd64.exe' -OutFile python-installer.exe

    - name: Install Python
      run: .\python-installer /quiet /passive Include_debug=1 PrependPath=1 TargetDir=C:\Python | more

    - uses: ilammy/msvc-dev-cmd@v1

    - name: Test
      env:
        LINT: ${{ runner.os == 'Linux' && matrix.python-version == '3.11' }}
      run: | 
        set LIB=C:\Python\Libs;%LIB%
        set TYPESHED_HOME=%cd%\typeshed
        set PATH=C:\Python;C:\Python\Scripts;%PATH%
        pip install -r requirements.txt
        python build_scripts/ci_script.py
      shell: cmd
